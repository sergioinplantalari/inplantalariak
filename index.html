<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Liga Futbolera</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <style>
    body {
      font-family: 'Arial', sans-serif;
      background: #c2f0c2;
      margin: 0;
      padding: 20px;
      max-width: 960px;
      margin-left: auto;
      margin-right: auto;
      box-sizing: border-box;
    }

    h1, h2 {
      text-align: center;
      color: #0a4d00;
    }

    .team-section {
      display: flex;
      flex-direction: column;
      gap: 20px;
      margin-bottom: 20px;
    }

    .team-section > div {
      flex: 1;
    }

    textarea {
      width: 100%;
      height: 120px;
      padding: 10px;
      border: 2px solid #006400;
      border-radius: 8px;
      background-color: #fafffa;
      resize: none;
      box-sizing: border-box;
    }

    select, button, input {
      padding: 10px;
      font-size: 16px;
      border-radius: 6px;
      border: 1px solid #006400;
      box-sizing: border-box;
      width: 100%;
      max-width: 300px;
    }

    .btn-group {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 20px;
      justify-content: center;
    }

    .bottom-buttons {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-top: 30px;
      justify-content: space-between;
      align-items: center;
    }

    table {
      width: 100%;
      margin-top: 20px;
      border-collapse: collapse;
      background-color: white;
    }

    th, td {
      padding: 10px;
      border: 1px solid #006400;
      text-align: center;
    }

    th {
      background-color: #008000;
      color: white;
    }

    .alias-form {
      margin-top: 30px;
      display: flex;
      flex-direction: column;
      gap: 10px;
      align-items: center;
    }

    .alias-form input {
      width: 100%;
      max-width: 300px;
    }

    @media (min-width: 768px) {
      .team-section {
        flex-direction: row;
      }

      .team-section > div {
        width: 50%;
      }

      .btn-group {
        justify-content: center;
      }

      .bottom-buttons {
        flex-direction: row;
        justify-content: space-between;
      }

      .alias-form {
        flex-direction: row;
        justify-content: center;
      }

      .alias-form input {
        width: auto;
      }
    }

    #fechaTemporal {
      display: none;
      text-align: right;
      font-size: 14px;
      margin-bottom: 5px;
    }
  </style>
</head>
<body>
  <h1>⚽ Liga Futbolera ⚽</h1>

  <div class="team-section">
    <div>
      <h2>🏳️ Blancos</h2>
      <textarea id="equipoBlanco" placeholder="1. Jugador&#10;2. Jugador"></textarea>
    </div>
    <div>
      <h2>🏴 Negros</h2>
      <textarea id="equipoNegro" placeholder="6. Jugador&#10;7. Jugador"></textarea>
    </div>
  </div>

  <div class="btn-group">
    <button onclick="guardarResultado('blancos')">🏳️ Victoria Blancos</button>
    <button onclick="guardarResultado('empate')">🤝 Empate</button>
    <button onclick="guardarResultado('negros')">🏴 Victoria Negros</button>
  </div>

  <div id="fechaTemporal"></div>
  <div id="tablaContainer">
    <table id="tablaClasificacion">
      <thead>
        <tr>
          <th>Jugador</th>
          <th>Puntos</th>
          <th>Jugados</th>
          <th>Victorias</th>
          <th>Empates</th>
          <th>Derrotas</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <div class="bottom-buttons">
    <button onclick="descargarClasificacion()">📥 Descargar clasificación en Excel</button>
    <button onclick="descargarPDF()">📝 Descargar clasificación en PDF</button>
    <button onclick="compartirWhatsapp()">📤 Compartir por WhatsApp</button>
    <button onclick="reiniciarPuntos()">🔄 Reiniciar Temporada</button>
  </div>

  <div class="alias-form">
    <input type="text" id="original" placeholder="Nombre original">
    <input type="text" id="alias" placeholder="Alias o nombre mal escrito">
    <button onclick="fusionarJugadores()">🔗 Unir jugadores</button>
  </div>

  <script>
    let jugadores = {};
    const datosGuardados = localStorage.getItem('jugadores');
    if (datosGuardados) jugadores = JSON.parse(datosGuardados);

    function getFechaActual() {
      return new Date().toISOString().slice(0,10).replace(/-/g, '');
    }

    function parseJugadores(text) {
      return text.split('\n').map(linea => linea.replace(/^\d+\.\s*/, '').trim()).filter(nombre => nombre !== '');
    }

    function guardarResultado(resultado) {
      const blancos = parseJugadores(document.getElementById('equipoBlanco').value);
      const negros = parseJugadores(document.getElementById('equipoNegro').value);
      const todos = [...blancos, ...negros];

      todos.forEach(nombre => {
        if (!jugadores[nombre]) jugadores[nombre] = { puntos: 0, jugados: 0, victorias: 0, empates: 0, derrotas: 0 };
        jugadores[nombre].jugados++;
      });

      if (resultado === 'blancos') {
        blancos.forEach(n => { jugadores[n].victorias++; jugadores[n].puntos += 3; });
        negros.forEach(n => jugadores[n].derrotas++);
      } else if (resultado === 'negros') {
        negros.forEach(n => { jugadores[n].victorias++; jugadores[n].puntos += 3; });
        blancos.forEach(n => jugadores[n].derrotas++);
      } else {
        [...blancos, ...negros].forEach(n => { jugadores[n].empates++; jugadores[n].puntos += 1; });
      }

      localStorage.setItem('jugadores', JSON.stringify(jugadores));
      actualizarTabla();
    }

    function actualizarTabla() {
      const tbody = document.querySelector("#tablaClasificacion tbody");
      tbody.innerHTML = "";
      const ordenados = Object.entries(jugadores).sort((a, b) => b[1].puntos - a[1].puntos);
      ordenados.forEach(([nombre, datos]) => {
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${nombre}</td>
          <td>${datos.puntos}</td>
          <td>${datos.jugados}</td>
          <td>${datos.victorias}</td>
          <td>${datos.empates}</td>
          <td>${datos.derrotas}</td>`;
        tbody.appendChild(row);
      });
    }

    function reiniciarPuntos() {
  const confirmar = confirm("¿Estás seguro de que quieres reiniciar la temporada?\nSe eliminarán todos los jugadores y sus estadísticas.");
  if (!confirmar) return;

  jugadores = {};
  localStorage.removeItem('jugadores');
  actualizarTabla();
}


    function fusionarJugadores() {
      const original = document.getElementById("original").value.trim();
      const alias = document.getElementById("alias").value.trim();
      if (!jugadores[original] || !jugadores[alias]) return;
      for (let key in jugadores[alias]) {
        jugadores[original][key] += jugadores[alias][key];
      }
      delete jugadores[alias];
      localStorage.setItem('jugadores', JSON.stringify(jugadores));
      actualizarTabla();
    }

    function descargarClasificacion() {
      const fecha = getFechaActual();
      let csv = 'Jugador,Puntos,Jugados,Victorias,Empates,Derrotas\n';
      Object.entries(jugadores).forEach(([nombre, stats]) => {
        csv += `${nombre},${stats.puntos},${stats.jugados},${stats.victorias},${stats.empates},${stats.derrotas}\n`;
      });
      const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
      const url = URL.createObjectURL(blob);
      const link = document.createElement("a");
      link.setAttribute("href", url);
      link.setAttribute("download", `clasificacion_liga_futbolera_${fecha}.csv`);
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    }

    function descargarPDF() {
      const fecha = getFechaActual();
      const tabla = document.getElementById("tablaClasificacion").outerHTML;
      const ventana = window.open('', '', 'height=800,width=800');
      ventana.document.write('<html><head><title>Clasificación PDF</title></head><body>');
      ventana.document.write(`<h1>Clasificación Liga Futbolera</h1><h2>📅 Fecha: ${fecha}</h2>`);
      ventana.document.write(tabla);
      ventana.document.write('</body></html>');
      ventana.document.close();
      ventana.print();
    }

    function compartirWhatsapp() {
      const fecha = getFechaActual();
      document.getElementById("fechaTemporal").innerText = `📅 Fecha: ${fecha}`;
      document.getElementById("fechaTemporal").style.display = 'block';

      html2canvas(document.getElementById("tablaContainer")).then(canvas => {
        document.getElementById("fechaTemporal").style.display = 'none';
        canvas.toBlob(blob => {
          const file = new File([blob], `clasificacion_${fecha}.png`, { type: 'image/png' });
          if (navigator.canShare && navigator.canShare({ files: [file] })) {
            navigator.share({
              title: "Clasificación Liga Futbolera",
              files: [file],
              text: `🏆 Clasificación del ${fecha}`
            });
          } else {
            alert("No se puede compartir automáticamente. Haz una captura de pantalla manual.");
          }
        });
      });
    }

    document.addEventListener("DOMContentLoaded", actualizarTabla);
  </script>
</body>
</html>
