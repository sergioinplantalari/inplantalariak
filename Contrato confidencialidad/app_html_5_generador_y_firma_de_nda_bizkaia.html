<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>⚖️ Generador y Firma de Contratos de Confidencialidad — Bizkaia</title>
  <style>
    /* =====================
       ESTILOS GLOBALES
       ===================== */
    :root {
      --grad-1: linear-gradient(135deg, #5b7cfa 0%, #7a5cff 35%, #8a5df0 70%, #7c4be3 100%);
      --grad-2: linear-gradient(135deg, #7f5cf3 0%, #5ab0ff 100%);
      --bg: #0b1020;
      --card-bg: #ffffff;
      --text: #1d2433;
      --muted: #52607a;
      --primary: #6946ff;
      --primary-dark: #4a2de0;
      --accent: #5ab0ff;
      --ok: #15a34a;
      --warn: #f59e0b;
      --err: #ef4444;
    }

    html, body {
      height: 100%;
      margin: 0;
      color: var(--text);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Inter, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji";
      background: radial-gradient(1200px 700px at 10% -10%, rgba(122,92,255,.25), transparent 60%),
                  radial-gradient(1200px 700px at 110% 10%, rgba(90,176,255,.25), transparent 60%),
                  var(--bg);
    }

    .container {
      max-width: 1100px;
      margin: 32px auto;
      padding: 0 16px 48px;
    }

    .card {
      background: var(--card-bg);
      border-radius: 18px;
      box-shadow: 0 15px 60px rgba(31, 38, 135, 0.15);
      overflow: hidden;
    }

    /* =====================
       ENCABEZADO
       ===================== */
    .header {
      padding: 28px 24px;
      color: white;
      background-image: var(--grad-1);
      display: flex;
      align-items: center;
      gap: 16px;
    }

    .logo {
      width: 44px; height: 44px;
      display: grid; place-items: center;
      border-radius: 12px;
      background: rgba(255,255,255,.18);
      backdrop-filter: blur(6px);
      font-size: 24px;
    }

    h1 {
      margin: 0;
      font-size: clamp(20px, 3.2vw, 28px);
      font-weight: 700;
      letter-spacing: .2px;
    }

    .subtitle { opacity: .9; margin-top: 4px; font-size: 14px; }

    /* =====================
       STEPPER
       ===================== */
    .stepper {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      padding: 18px 24px;
      background: #f6f7fb;
      border-bottom: 1px solid #eef0f6;
    }

    .step {
      display: grid;
      grid-template-columns: 30px auto;
      align-items: center;
      gap: 10px;
      padding: 10px 12px;
      border-radius: 12px;
      flex: 1;
      min-width: 0;
      transition: background .25s ease, color .25s ease;
      color: #374151;
    }

    .step.active {
      background: linear-gradient(0deg, rgba(105,70,255,.08), rgba(105,70,255,.08)), white;
      color: var(--primary-dark);
      box-shadow: inset 0 0 0 1px rgba(105,70,255,.12);
    }

    .step .badge {
      height: 30px; width: 30px; border-radius: 50%;
      display: grid; place-items: center; font-weight: 700;
      background: var(--grad-2); color: white;
      font-size: 14px;
    }

    .step .title { font-weight: 700; font-size: 14px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .step .desc { font-size: 12px; color: #6b7280; }

    /* =====================
       CONTENIDO
       ===================== */
    .section { display: none; padding: 24px; }
    .section.active { display: block; }

    .grid-2 {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
    }

    .grid-3 {
      display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px;
    }

    .form-card {
      border: 1px solid #eef0f6;
      border-radius: 16px;
      padding: 18px;
    }

    .form-card h3 {
      margin: 0 0 12px 0;
      font-size: 16px;
      color: #111827;
    }

    label { display: block; font-size: 13px; color: #374151; margin: 10px 0 6px; }
    input, textarea, select {
      width: 100%;
      padding: 12px 12px;
      border-radius: 12px;
      border: 1px solid #e5e7eb;
      outline: none;
      font-size: 14px;
      transition: border-color .2s ease, box-shadow .2s ease;
      background: #fff;
    }

    input:focus, textarea:focus, select:focus {
      border-color: #b7c5ff;
      box-shadow: 0 0 0 3px rgba(105,70,255,.15);
    }

    textarea { min-height: 110px; resize: vertical; }

    .actions {
      display: flex; flex-wrap: wrap; gap: 12px; padding: 20px 24px 28px; border-top: 1px solid #eef0f6;
    }

    .btn {
      border: none; cursor: pointer; padding: 12px 16px; border-radius: 12px; font-weight: 700; font-size: 14px;
      background-image: var(--grad-2); color: #fff; box-shadow: 0 8px 20px rgba(90,176,255,.35);
      transition: transform .05s ease, box-shadow .2s ease, filter .2s ease;
    }
    .btn:hover { filter: brightness(1.03); box-shadow: 0 10px 24px rgba(90,176,255,.45); }
    .btn:active { transform: translateY(1px); }

    .btn.secondary { background-image: linear-gradient(0deg, #f3f4f6, #f3f4f6); color: #374151; box-shadow: none; }
    .btn.ghost { background: transparent; color: var(--primary-dark); box-shadow: none; }
    .btn.danger { background-image: linear-gradient(135deg, #ff6b6b, #ef4444); box-shadow: 0 8px 20px rgba(239,68,68,.35); }

    .help { color: #6b7280; font-size: 12px; margin-top: 6px; }

    /* =====================
       FIRMAS
       ===================== */
    .signature-wrap { border: 1px dashed #c7cbe5; border-radius: 14px; padding: 12px; background: #fafbff; }
    .sig-meta { display: flex; align-items: center; justify-content: space-between; gap: 12px; margin-bottom: 8px; }
    .sig-meta strong { font-size: 13px; color: #111827; }
    canvas.signature { width: 100%; max-width: 100%; border-radius: 10px; background: #fff; box-shadow: inset 0 0 0 1px #e5e7eb; }

    .sig-buttons { display: flex; gap: 8px; }

    /* =====================
       DOCUMENTO
       ===================== */
    .doc {
      background: #ffffff;
      color: #111827;
      max-width: 800px;
      margin: 0 auto;
      padding: 40px 36px;
      border: 1px solid #e5e7eb;
      border-radius: 12px;
    }
    .doc h2 { text-align: center; font-size: 20px; margin: 0 0 8px; }
    .doc .date { text-align: center; font-size: 13px; color: #4b5563; margin-bottom: 20px; }
    .doc h3 { margin-top: 22px; font-size: 16px; }
    .doc p, .doc li { line-height: 1.6; font-size: 14px; text-align: justify; }
    .doc ul { margin: 6px 0 0 18px; }

    .sign-blocks { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 30px; }
    .sign-box { text-align: center; }
    .sign-img { width: 100%; max-width: 360px; height: 90px; object-fit: contain; border-bottom: 1px solid #cbd5e1; margin: 6px auto 6px; }
    .sign-meta { font-size: 12px; color: #374151; }

    .notice { background: #f5f7ff; color: #374151; border-left: 4px solid #7a5cff; padding: 12px 14px; border-radius: 10px; font-size: 13px; }

    /* =====================
       RESPONSIVE
       ===================== */
    @media (max-width: 900px) {
      .grid-2 { grid-template-columns: 1fr; }
      .grid-3 { grid-template-columns: 1fr; }
      .sign-blocks { grid-template-columns: 1fr; }
    }

    /* =====================
       IMPRESIÓN
       ===================== */
    @media print {
      body { background: #fff; }
      .container, .card, .section { padding: 0; margin: 0; box-shadow: none; }
      .header, .stepper, .actions, .notice, .no-print { display: none !important; }
      .doc { border: none; border-radius: 0; padding: 8mm; width: 190mm; max-width: none; }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="card">
      <div class="header">
        <div class="logo" aria-hidden="true">⚖️</div>
        <div>
          <h1>Generador y Firma de Contratos de Confidencialidad (NDA) — Bizkaia</h1>
          <div class="subtitle">Aplicación web para abogados colegiados en Bizkaia. Complete los datos, recabe las firmas y obtenga un contrato listo para imprimir o guardar en PDF.</div>
        </div>
      </div>

      <!-- STEPPER -->
      <div class="stepper" role="tablist" aria-label="Progreso del contrato">
        <div class="step active" id="step-indicator-1">
          <div class="badge">1</div>
          <div>
            <div class="title">Datos</div>
            <div class="desc">Abogado, cliente y asunto</div>
          </div>
        </div>
        <div class="step" id="step-indicator-2">
          <div class="badge">2</div>
          <div>
            <div class="title">Firmas</div>
            <div class="desc">Abogado y cliente</div>
          </div>
        </div>
        <div class="step" id="step-indicator-3">
          <div class="badge">3</div>
          <div>
            <div class="title">Documento</div>
            <div class="desc">Contrato generado</div>
          </div>
        </div>
      </div>

      <!-- SECCIÓN 1: FORMULARIO -->
      <section class="section active" id="section-1" aria-labelledby="step-indicator-1">
        <div class="grid-2">
          <div class="form-card" aria-describedby="ayuda-obligatorios">
            <h3>Datos del abogado</h3>
            <label for="abogadoNombre">Nombre completo</label>
            <input id="abogadoNombre" required placeholder="Nombre y apellidos" />

            <label for="abogadoDni">DNI</label>
            <input id="abogadoDni" required placeholder="12345678Z" pattern="^[0-9]{7,8}[A-Za-z]$" title="Formato de DNI válido (8 dígitos y letra)" />

            <label for="abogadoColegiado">Nº de colegiado</label>
            <input id="abogadoColegiado" required placeholder="ICABIZ-0000" />

            <label for="abogadoDespacho">Nombre del despacho (opcional)</label>
            <input id="abogadoDespacho" placeholder="Despacho/Bufete" />

            <label for="abogadoDireccion">Dirección en Bizkaia</label>
            <input id="abogadoDireccion" required placeholder="Calle, número, municipio (Bizkaia)" />
          </div>

          <div class="form-card">
            <h3>Datos del cliente</h3>
            <label for="clienteNombre">Nombre completo</label>
            <input id="clienteNombre" required placeholder="Nombre y apellidos" />

            <label for="clienteDni">DNI/NIE</label>
            <input id="clienteDni" required placeholder="12345678Z / X1234567L" />

            <label for="clienteDireccion">Dirección</label>
            <input id="clienteDireccion" required placeholder="Calle, número, municipio" />
          </div>
        </div>

        <div class="form-card" style="margin-top:16px">
          <h3>Detalles del asunto</h3>
          <label for="descripcionCaso">Descripción del caso legal</label>
          <textarea id="descripcionCaso" required placeholder="Describa brevemente el asunto para el que se firma el NDA"></textarea>

          <div class="grid-3">
            <div>
              <label for="fechaInicio">Fecha de inicio</label>
              <input type="date" id="fechaInicio" required />
            </div>
            <div>
              <label for="duracion">Duración del acuerdo</label>
              <select id="duracion" required>
                <option value="1">1 año</option>
                <option value="2">2 años</option>
                <option value="3">3 años</option>
                <option value="5">5 años</option>
                <option value="10">10 años</option>
              </select>
            </div>
            <div>
              <label for="lugarFirma">Lugar de firma</label>
              <input id="lugarFirma" required placeholder="Bilbao (Bizkaia)" />
            </div>
          </div>
          <div id="ayuda-obligatorios" class="help">Todos los campos son obligatorios salvo el nombre del despacho.</div>
        </div>

        <div class="actions">
          <button class="btn" id="go-step-2">Continuar a Firmas</button>
          <button class="btn secondary" id="reset-1" type="button">Limpiar formulario</button>
        </div>
      </section>

      <!-- SECCIÓN 2: FIRMAS -->
      <section class="section" id="section-2" aria-labelledby="step-indicator-2">
        <div class="notice">Firme con el ratón o con el dedo (pantalla táctil). Use «Limpiar» para repetir la firma. El trazo se guarda como imagen para insertarse en el contrato.</div>

        <div class="grid-2" style="margin-top:16px">
          <div class="form-card">
            <h3>Firma del abogado</h3>
            <div class="signature-wrap">
              <div class="sig-meta"><strong>Área de firma (800×200 px)</strong><div class="sig-buttons"><button class="btn secondary no-print" data-clear="abogado">Limpiar</button></div></div>
              <canvas id="sigAbogado" class="signature" width="800" height="200" aria-label="Firma del abogado"></canvas>
            </div>
          </div>

          <div class="form-card">
            <h3>Firma del cliente</h3>
            <div class="signature-wrap">
              <div class="sig-meta"><strong>Área de firma (800×200 px)</strong><div class="sig-buttons"><button class="btn secondary no-print" data-clear="cliente">Limpiar</button></div></div>
              <canvas id="sigCliente" class="signature" width="800" height="200" aria-label="Firma del cliente"></canvas>
            </div>
          </div>
        </div>

        <div class="actions">
          <button class="btn secondary" id="back-step-1">Volver</button>
          <button class="btn" id="go-step-3">Generar documento</button>
        </div>
      </section>

      <!-- SECCIÓN 3: DOCUMENTO -->
      <section class="section" id="section-3" aria-labelledby="step-indicator-3">
        <div class="doc" id="documento">
          <!-- El contenido se inyectará dinámicamente -->
        </div>

        <div class="actions">
          <button class="btn secondary" id="back-step-2">Volver</button>
          <button class="btn" id="printBtn">Imprimir / Guardar PDF</button>
          <button class="btn ghost" id="nuevoContrato">Crear nuevo contrato</button>
        </div>
      </section>
    </div>
  </div>

  <script>
    // ==============================
    // UTILIDADES
    // ==============================
    const $ = (sel) => document.querySelector(sel);
    const $$ = (sel) => document.querySelectorAll(sel);

    function setActiveStep(n) {
      [1,2,3].forEach(i => {
        $('#section-' + i).classList.toggle('active', i === n);
        $('#step-indicator-' + i).classList.toggle('active', i === n);
      });
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function todayISO() {
      const d = new Date();
      const tz = new Date(d.getTime() - d.getTimezoneOffset()*60000);
      return tz.toISOString().slice(0,10);
    }

    function formatFechaES(fechaStr) {
      const [y, m, d] = fechaStr.split('-').map(Number);
      const date = new Date(y, m-1, d);
      return new Intl.DateTimeFormat('es-ES', { day: '2-digit', month: 'long', year: 'numeric' }).format(date);
    }

    // ==============================
    // VALIDACIÓN SIMPLE
    // ==============================
    function validarFormulario() {
      const reqIds = ['abogadoNombre','abogadoDni','abogadoColegiado','abogadoDireccion','clienteNombre','clienteDni','clienteDireccion','descripcionCaso','fechaInicio','duracion','lugarFirma'];
      let ok = true;
      reqIds.forEach(id => {
        const el = document.getElementById(id);
        if (!el.checkValidity() || !el.value.trim()) {
          el.reportValidity();
          el.scrollIntoView({ behavior:'smooth', block:'center' });
          ok = false;
          return;
        }
      });
      return ok;
    }

    // ==============================
    // FIRMA — DIBUJO EN CANVAS (mouse + touch)
    // ==============================
    class SignaturePad {
      constructor(canvas) {
        this.canvas = canvas;
        this.ctx = canvas.getContext('2d');
        this.drawing = false;
        this.points = [];
        this._setup();
      }
      _setup() {
        const c = this.canvas;
        // Trazo elegante
        this.ctx.lineWidth = 2;
        this.ctx.lineCap = 'round';
        this.ctx.lineJoin = 'round';
        this.ctx.strokeStyle = '#111827';

        // Eventos de ratón
        c.addEventListener('mousedown', (e) => this._start(e.offsetX, e.offsetY));
        c.addEventListener('mousemove', (e) => this._move(e.offsetX, e.offsetY));
        c.addEventListener('mouseup', () => this._end());
        c.addEventListener('mouseleave', () => this._end());

        // Eventos táctiles
        c.addEventListener('touchstart', (e) => {
          e.preventDefault();
          const {x,y} = this._touchPos(e);
          this._start(x,y);
        }, { passive: false });
        c.addEventListener('touchmove', (e) => {
          e.preventDefault();
          const {x,y} = this._touchPos(e);
          this._move(x,y);
        }, { passive: false });
        c.addEventListener('touchend', () => this._end());

        // Ajuste de escala para nitidez en HiDPI sin cambiar tamaño lógico 800x200
        const ratio = Math.max(window.devicePixelRatio || 1, 1);
        if (ratio !== 1) {
          const w = c.width, h = c.height;
          c.width = w * ratio; c.height = h * ratio; c.style.width = w + 'px'; c.style.height = h + 'px';
          this.ctx.scale(ratio, ratio);
        }
      }
      _touchPos(e){
        const rect = this.canvas.getBoundingClientRect();
        const t = e.touches[0] || e.changedTouches[0];
        const x = (t.clientX - rect.left) * (this.canvas.width / rect.width);
        const y = (t.clientY - rect.top) * (this.canvas.height / rect.height);
        const ratio = Math.max(window.devicePixelRatio || 1, 1);
        return { x: x/ratio, y: y/ratio };
      }
      _start(x,y){ this.drawing = true; this.points.push({x,y}); this.ctx.beginPath(); this.ctx.moveTo(x,y); }
      _move(x,y){ if(!this.drawing) return; this.points.push({x,y}); this.ctx.lineTo(x,y); this.ctx.stroke(); }
      _end(){ this.drawing = false; this.ctx.closePath(); }
      clear(){ this.ctx.clearRect(0,0,this.canvas.width, this.canvas.height); this.points = []; }
      isEmpty(){ return this.points.length === 0; }
      toDataURL(){ return this.canvas.toDataURL('image/png'); }
    }

    const sigAbogadoPad = new SignaturePad(document.getElementById('sigAbogado'));
    const sigClientePad = new SignaturePad(document.getElementById('sigCliente'));

    // Botones de limpiar
    $$("[data-clear='abogado']").forEach(b => b.addEventListener('click', () => sigAbogadoPad.clear()));
    $$("[data-clear='cliente']").forEach(b => b.addEventListener('click', () => sigClientePad.clear()));

    // ==============================
    // NAVEGACIÓN DE PASOS
    // ==============================
    document.getElementById('fechaInicio').value = todayISO();

    document.getElementById('reset-1').addEventListener('click', () => {
      ['abogadoNombre','abogadoDni','abogadoColegiado','abogadoDespacho','abogadoDireccion','clienteNombre','clienteDni','clienteDireccion','descripcionCaso','lugarFirma'].forEach(id => document.getElementById(id).value = '');
      document.getElementById('fechaInicio').value = todayISO();
      document.getElementById('duracion').value = '1';
    });

    document.getElementById('go-step-2').addEventListener('click', () => {
      if (!validarFormulario()) return;
      setActiveStep(2);
    });

    document.getElementById('back-step-1').addEventListener('click', () => setActiveStep(1));

    document.getElementById('go-step-3').addEventListener('click', () => {
      if (sigAbogadoPad.isEmpty() || sigClientePad.isEmpty()) {
        alert('Debe incluir ambas firmas para generar el documento.');
        return;
      }
      generarDocumento();
      setActiveStep(3);
    });

    document.getElementById('back-step-2').addEventListener('click', () => setActiveStep(2));

    document.getElementById('printBtn').addEventListener('click', () => window.print());

    document.getElementById('nuevoContrato').addEventListener('click', () => {
      // Reinicio total sin usar almacenamiento local ni de sesión
      sigAbogadoPad.clear();
      sigClientePad.clear();
      ['abogadoNombre','abogadoDni','abogadoColegiado','abogadoDespacho','abogadoDireccion','clienteNombre','clienteDni','clienteDireccion','descripcionCaso','lugarFirma'].forEach(id => document.getElementById(id).value = '');
      document.getElementById('fechaInicio').value = todayISO();
      document.getElementById('duracion').value = '1';
      document.getElementById('documento').innerHTML = '';
      setActiveStep(1);
    });

    // ==============================
    // GENERACIÓN DEL DOCUMENTO LEGAL (ES)
    // ==============================
    function generarDocumento(){
      const datos = {
        abogadoNombre: $('#abogadoNombre').value.trim(),
        abogadoDni: $('#abogadoDni').value.trim().toUpperCase(),
        abogadoColegiado: $('#abogadoColegiado').value.trim(),
        abogadoDespacho: $('#abogadoDespacho').value.trim(),
        abogadoDireccion: $('#abogadoDireccion').value.trim(),
        clienteNombre: $('#clienteNombre').value.trim(),
        clienteDni: $('#clienteDni').value.trim().toUpperCase(),
        clienteDireccion: $('#clienteDireccion').value.trim(),
        descripcionCaso: $('#descripcionCaso').value.trim(),
        fechaInicio: $('#fechaInicio').value,
        duracion: $('#duracion').value,
        lugarFirma: $('#lugarFirma').value.trim(),
        fechaHoy: todayISO()
      };

      const fechaES = formatFechaES(datos.fechaInicio);
      const hoyES = formatFechaES(datos.fechaHoy);
      const sigAbogadoURL = sigAbogadoPad.toDataURL();
      const sigClienteURL = sigClientePad.toDataURL();

      const despachoLinea = datos.abogadoDespacho ? `, actuando en nombre y representación de su despacho «${escapeHtml(datos.abogadoDespacho)}»` : '';

      const docHtml = `
        <h2>CONTRATO DE CONFIDENCIALIDAD (NDA)</h2>
        <div class="date">Fecha de efectos: ${escapeHtml(fechaES)} — ${escapeHtml(datos.lugarFirma)}</div>

        <h3>REUNIDOS</h3>
        <p><strong>De una parte</strong>, D./Dª <strong>${escapeHtml(datos.abogadoNombre)}</strong>, con DNI <strong>${escapeHtml(datos.abogadoDni)}</strong>, colegiado/a nº <strong>${escapeHtml(datos.abogadoColegiado)}</strong> del Ilustre Colegio de la Abogacía de Bizkaia, con domicilio profesional en <strong>${escapeHtml(datos.abogadoDireccion)}</strong>${despachoLinea} (en adelante, «<em>EL ABOGADO</em>»).</p>
        <p><strong>Y de otra</strong>, D./Dª <strong>${escapeHtml(datos.clienteNombre)}</strong>, con DNI/NIE <strong>${escapeHtml(datos.clienteDni)}</strong>, con domicilio en <strong>${escapeHtml(datos.clienteDireccion)}</strong> (en adelante, «<em>EL CLIENTE</em>»).</p>
        <p>Ambas partes se reconocen capacidad legal suficiente para contratar y, a tal efecto,</p>

        <h3>EXPONEN</h3>
        <ul>
          <li>Que EL CLIENTE ha solicitado los servicios profesionales de EL ABOGADO en relación con el asunto: <strong>${escapeHtml(datos.descripcionCaso)}</strong>.</li>
          <li>Que, con motivo de la relación profesional, será necesario el acceso e intercambio de información de carácter confidencial.</li>
          <li>Que las partes desean establecer las condiciones bajo las cuales dicha información será protegida y utilizada.</li>
        </ul>

        <h3>CLÁUSULAS</h3>
        <ol>
          <li><strong>Objeto.</strong> El objeto del presente contrato es regular el tratamiento de la Información Confidencial que cualquiera de las partes comunique a la otra en el marco del asunto descrito, desde la fecha indicada y durante la vigencia señalada.</li>
          <li><strong>Definición de Información Confidencial.</strong> Se entenderá por «Información Confidencial» toda información, ya sea oral, escrita, gráfica, digital o de cualquier otra naturaleza o soporte, incluyendo, a título enunciativo y no limitativo, datos personales, estrategias, documentos, comunicaciones, borradores, pruebas, acuerdos, datos económicos y cualesquiera datos relativos al asunto, que no sean públicos en el momento de su comunicación.</li>
          <li><strong>Obligaciones de confidencialidad.</strong> La parte receptora se obliga a: (i) utilizar la Información Confidencial exclusivamente para la prestación de los servicios profesionales objeto del encargo; (ii) no divulgarla a terceros sin consentimiento previo y por escrito de la parte divulgadora, salvo a colaboradores necesarios sujetos a deber de secreto profesional; (iii) custodiarla con el mismo nivel de diligencia que emplea para su propia información confidencial y, en todo caso, con un nivel de protección razonable.</li>
          <li><strong>Excepciones.</strong> No tendrá la consideración de Información Confidencial aquella que: (i) fuera pública en el momento de su comunicación o llegare a serlo sin incumplimiento del presente contrato; (ii) ya obrara legítimamente en poder de la parte receptora; (iii) fuese obtenida de tercero sin deber de confidencialidad; o (iv) deba revelarse en cumplimiento de obligación legal o requerimiento de autoridad competente, en cuyo caso la parte receptora lo notificará a la otra parte en la medida en que la ley lo permita.</li>
          <li><strong>Protección de datos (RGPD y LOPDGDD).</strong> En la medida en que la Información Confidencial contenga datos personales, EL ABOGADO actuará como responsable del tratamiento respecto de sus propios ficheros y como encargado del tratamiento respecto de los datos que EL CLIENTE le facilite para la tramitación del encargo, aplicando las medidas de seguridad técnicas y organizativas apropiadas conforme al Reglamento (UE) 2016/679 (RGPD) y la Ley Orgánica 3/2018. EL CLIENTE declara haber sido informado de la política de privacidad y de los derechos de acceso, rectificación, supresión, oposición, limitación y portabilidad.</li>
          <li><strong>Duración.</strong> La obligación de confidencialidad entrará en vigor en la fecha de efectos y se mantendrá durante <strong>${escapeHtml(datos.duracion)}</strong> año(s) a contar desde la fecha de terminación del encargo profesional, sin perjuicio de los deberes derivados del secreto profesional del abogado que tienen carácter indefinido.</li>
          <li><strong>Devolución y destrucción.</strong> A solicitud de la parte divulgadora, la parte receptora devolverá o destruirá la Información Confidencial y todas sus copias cuando dejen de ser necesarias para el fin para el que fueron comunicadas, salvo conservación exigida por normativa o justificación legítima (por ejemplo, defensa frente a reclamaciones).</li>
          <li><strong>No cesión de derechos.</strong> El presente contrato no concede licencia ni derecho alguno sobre derechos de propiedad intelectual, industrial o secretos empresariales más allá de lo expresamente previsto.</li>
          <li><strong>Legislación y fuero.</strong> El contrato se regirá por el Derecho español. Para cuantas cuestiones litigiosas pudieran suscitarse sobre su interpretación, cumplimiento o ejecución, las partes, con renuncia expresa a cualquier otro fuero que pudiera corresponderles, se someten a los Juzgados y Tribunales de <strong>Bilbao (Bizkaia)</strong>, salvo que por imperativo legal corresponda otro fuero.</li>
        </ol>

        <p>Y en prueba de conformidad, las partes firman el presente documento en el lugar y fecha indicados.</p>
        <p style="text-align:center; font-size:12px; color:#6b7280;">Firmado electrónicamente el ${escapeHtml(hoyES)}.</p>

        <div class="sign-blocks">
          <div class="sign-box">
            <div class="sign-img-wrap"><img class="sign-img" alt="Firma del abogado" src="${sigAbogadoURL}"/></div>
            <div><strong>${escapeHtml(datos.abogadoNombre)}</strong></div>
            <div class="sign-meta">DNI: ${escapeHtml(datos.abogadoDni)} · Col.: ${escapeHtml(datos.abogadoColegiado)}<br/>${escapeHtml(datos.abogadoDireccion)}</div>
          </div>
          <div class="sign-box">
            <div class="sign-img-wrap"><img class="sign-img" alt="Firma del cliente" src="${sigClienteURL}"/></div>
            <div><strong>${escapeHtml(datos.clienteNombre)}</strong></div>
            <div class="sign-meta">DNI/NIE: ${escapeHtml(datos.clienteDni)}<br/>${escapeHtml(datos.clienteDireccion)}</div>
          </div>
        </div>
      `;

      $('#documento').innerHTML = docHtml;
    }

    function escapeHtml(str){
      return str
        .replaceAll('&','&amp;')
        .replaceAll('<','&lt;')
        .replaceAll('>','&gt;')
        .replaceAll('"','&quot;')
        .replaceAll("'",'&#039;');
    }
  </script>
</body>
</html>
